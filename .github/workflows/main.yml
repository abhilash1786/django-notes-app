name: build-and-push

on:
  push:
    branches:
      - main

env:
  ECR_REPOSITORY: my-ecr-repo
  IMAGE_TAG: latest

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Build Docker image
        run: docker build -t $ECR_REPOSITORY:$IMAGE_TAG .

      - name: Login to Amazon ECR
        uses: aws-actions/amazon-ecr-login@v1

      - name: Push Docker image to Amazon ECR
        uses: aws-actions/amazon-ecr-push-image@v2
        with:
          repository-name: $ECR_REPOSITORY
          image-tag: $IMAGE_TAG
